<!DOCTYPE html>
<!-- ●ここから人間用のヘッダー● -->
<html lang="ja">

<head>
 <link rel="manifest" href="/manifest.json">

 <script>
  if ('serviceWorker' in navigator) {
   navigator.serviceWorker.register('/service-worker.js')
    .then(registration => {
     console.log('ServiceWorker registration successful with scope: ', registration.scope);
    })
    .catch(error => {
     console.log('ServiceWorker registration failed: ', error);
    });
  }
 </script>

 <!-- Google tag (gtag.js) -->
 <script async src="https://www.googletagmanager.com/gtag/js?id=G-827JM6N5CS"></script>
 <script>
  window.dataLayer = window.dataLayer || [];
  function gtag() { dataLayer.push(arguments); }
  gtag('js', new Date());

  gtag('config', 'G-827JM6N5CS');
 </script>

 <!-- Microsoft tag -->
 <script>
  (function (c, l, a, r, i, t, y) {
   c[a] = c[a] || function () { (c[a].q = c[a].q || []).push(arguments) };
   t = l.createElement(r); t.async = 1; t.src = "https://www.clarity.ms/tag/" + i;
   y = l.getElementsByTagName(r)[0]; y.parentNode.insertBefore(t, y);
  })(window, document, "clarity", "script", "obazqypsh8");
 </script>

 <meta charset="UTF-8">

 <!--基本のメタタグ-->
 <meta name="description" content="ナビゲーションメニューの作り方に関するページ。可能な限り、教科書でもよく見るようなコードのみで構成しています。">
 <meta name="keywords" content="個人サイト, ナビゲーションメニュー, パンくずリスト">
 <meta name="robots" content="index, follow">
 <meta property="og:title" content="ナビゲーションメニューをCSS・JavaScriptで用意する">
 <meta property="og:description" content="ナビゲーションメニューの作り方に関するページ。可能な限り、教科書でもよく見るようなコードのみで構成しています。">
 <meta property="og:image" content="../image/アナザーエデンのバディ_ピスケ.png">
 <meta property="og:url" content="https://feinatelier.org/contents/navcode.html">

 <!--検索ヒット時のアイコン-->
 <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": "ナビゲーションメニューをCSS・JavaScriptで用意する",
  "url": "https://feinatelier.org/contents/navcode.html",
  "logo": "https://feinatelier.org/image/barracuda.jpeg"
}
</script>

 <!--レスポンシブデザイン-->
 <meta name="viewport" content="width=device-width, initial-scale=1.0">

 <!--CSS-->
 <link rel="stylesheet" type="text/css" href="/css/style.css">
 <link rel="stylesheet" type="text/css" href="/css/header.css">
 <link rel="stylesheet" type="text/css" href="/css/footer.css">
 <link rel="stylesheet" type="text/css" href="/css/menu.css">
 <link rel="stylesheet" type="text/css" href="/css/flower.css">
 <link rel="stylesheet" type="text/css" href="/css/feinpan.css">
 <link rel="stylesheet" type="text/css" href="/css/feinheadline1.css">
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism-tomorrow.min.css">


 <!--JavaScript-->
 <script src="/script/underline.js"></script>
 <script src="/script/feinfade.js"></script>
 <script src="/script/feinScroll.js"></script>


 <!-- prismの読み込み -->
 <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js"></script>

 <!-- google fonts -->
 <link rel="preconnect" href="https://fonts.googleapis.com">
 <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
 <link
  href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100..900&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap"
  rel="stylesheet">

 <!--ページタイトル-->
 <title>ナビゲーションメニューをCSS・JavaScriptで用意する</title>

 <!--ASノーナのファビコン-->
 <link rel="apple-touch-icon" sizes="180x180" href="/icons/appleicon.png">
 <link rel="icon" sizes="32x32" href="/favicon.ico" type="image/x-icon">
</head>

<body>

 <nav class="den_nav">
  <ul>
   <li>
    <a href="https://feinatelier.org/" class="animated-link feinhome-link">
     <img src="/menu/mspass.webp" alt="このサイトのシンボルマーク" class="feinhome">
     <span>fein's home</span>
    </a>
   </li>

   <li><a href="/another-eden/anaden_sitemap.html" class="animated-link">アナザーエデン</a></li>
   <li><a href="/fish/fish_sitemap.html" class="animated-link">アウトドアのエリア</a></li>
   <li><a href="/contents/site_create.html" class="animated-link">個人サイト制作</a></li>
   <li><a href="/contents/protect.html" class="animated-link">AI学習を防ぐ工夫</a></li>
   <li><a href="/contents/rss.html" class="animated-link">更新のお知らせ</a></li>
  </ul>
 </nav>

 <!--レスポンシブデザイン-->
 <div class="feincontainer">

  <!--パンくずリスト-->
  <div>
   <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/">Home（グラスタの場所一覧表〜入手範囲別〜）</a></li>
    <li class="breadcrumb-item"><a href="site_create.html">個人サイト制作：サイトマップ</a></li>
    <li class="breadcrumb-item active" aria-current="page">ナビゲーションメニューをCSS・JavaScriptで用意する</li>
   </ol>
  </div>



  <!-- ハンバーガーメニュー -->
  <div class="fden-hamburger-menu">
   <button class="fden-hamburger-button" id="fden-hamburger-button" onclick="toggleMenu()">☰ メニューを開く
    ▼</button>
   <div class="fden-menu" id="fden-menu">
    <!-- メニュー内容は外部ファイルから読み込む -->
    <div id="fden-menu-content"></div>
   </div>
  </div>
  <script src="../script/menu.js"></script>
  <!-- ハンバーガーメニューここまで -->

  <!--サイトタイトル-->
  <div class="header-frame">
   <div class="header-container">
    <img src="../image/cloudsitetitle.jpg" alt="Fein Atelier - org" class="header-image">
    <div class="header-text">
     <a href="https://feinatelier.org/">Fein Atelier - org</a>
    </div>
   </div>
  </div>

  <div class="spacer"></div>
  <button id="generate-headings" data-open-text="ナビゲーションメニューをCSS・JavaScriptで用意するの目次を開く ▼"
   data-close-text="ナビゲーションメニューをCSS・JavaScriptで用意するの目次を閉じる ▲">ナビゲーションメニューをCSS・JavaScriptで用意するの目次を開く
   ▼</button><!--目次の自動生成-->
  <div class="spacer"></div>
  <p><a href="site_create.html">個人サイト制作：サイトマップへ戻る</a></p>

  <!-- ●人間用のヘッダーここまで。直下でコンテンツ開始● -->

  <h1 class="background-waveimage-heading"><span>ナビゲーションメニューをCSS・JavaScriptで用意する</span></h1>
  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="/flower2/flower2(3).JPG" alt="フェードアウト効果の草花写真">
   </div>
   <p>表題ではナビゲーションメニューと書いていますが、Webページを作る時に重要な要素をここで紹介します。<br>
    パンくずリストは忘れられがちですが、閲覧者がWebサイト内で自分がどこにいるのか知るために重要な情報を提供します。<br>
    検索ボックスはあったほうが良いけど、何かあった時に面倒だからGoogle製のボックスを設置しています。<br>
    アコーディオン型の見出しは、特に長くなりがちなWebページの場合はあったほうがよいですね。<br>
    個人的にはWebページごと切り替わってしまうページリンクは不要と考えています。</p>
  </div>

  <p>最後に、ハンバーガーメニューです。<br>
   およそ個人でWebサイトを作ろうという話題になると必ず登場する「メニュー」ですよ。<br>
   いろんな形があるけど、タップするとズラズラとリンクが表示されるハンバーガータイプのことを指していると考えて良いです。</p>

  <p>ここでは、事後のメンテナンスまで含めてコードを紹介します。</p>

  <h3>このページに関する注意事項</h3>
  <p>当Webサイト作成者は、例示を目的としてマークアップ及びプログラミング例を提供しており、明示または黙示にかかわらず、いかなる責任も負わないものとします。<br>
   このページは、説明されているマークアップ及びプログラミング言語、手順を作成およびデバッグするために使用される各種ツールに読者が精通していることを前提にしています。<br>
   このページは、特定の機能を説明するのに役立つ可能性がありますが、当Webサイト作成者がこれらの例を変更した上で、特定の要件を満たすために追加の機能を提供したり、システムを構築したりすることはできません。<br>
   加えて、この例の手順に従う場合は、読者の各種ファイルを事前にバックアップすることを推奨いたします。</p>

  <h2>検索ボックス</h2>
  <p>開口一番言っちゃうけど、自力実装はお勧めしないかな。<br>
   検索システムなんてそうそう簡単に作れるもんじゃないし、作ったら作ったで面倒な要望案件の原因になります。</p>
  <p class="codegra" id="fainpangoogle_css">検索ボックスを整えるfainpan.css</p>
  <div class="code-container">
   <pre><code class="feintyping language-css">
/* 検索コンテナのスタイル */
.search-container {
    width: 50%; /* 横幅を50%に設定 */
    margin-top: 20px; /* パンくずリストの下に配置 */
    margin-left: auto; /* 右側に配置 */
    background-color: white; /* 背景色を白に設定 */
    border-radius: 10px; /* 四隅を丸める */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* 影を追加 */
    padding: 5px; /* 上下の内側の余白を縮小 */
}

/* 検索コンポーネントのスタイル */
.gcse-search {
    width: 100%; /* 横幅を親要素に合わせる */
}

/* 入力フィールドと検索ボタンのスタイル */
input.gsc-input,
input.gsc-search-button {
    width: 100%; /* 入力フィールドとボタンの横幅を100%に設定 */
    border-radius: 10px; /* 四隅を丸める */
    padding: 5px; /* 上下の内側の余白を縮小 */
}
    </code></pre>
  </div>
  <p>私はGoogleの検索ボックスをそのまま借りてきて、上記のようにCSSでデザインしているだけです。<br>
   ユーザーに入力させるUIを自力実装しないようにしてます。<br>
   何かあると対応が大変だし、万が一のことがあってもこういう形ならサイト制作者に直接的な責任がかかりません。</p>

  <h2>アコーディオン型の見出し</h2>
  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="/flower2/flower2(6).JPG" alt="フェードアウト効果の草花写真">
   </div>
   <p>この手のUIはいろんな実装方法がありますが、私の場合は見出しタグに連動して自動的に生成されるようにJavaScriptで組んでいます。<br>
    もちろんjQuery等のライブラリを使っても良いしそれが一般的な形でもあるんだけど、まずは簡素なものを書いて設置しておき、様子を見ながらライブラリ等のツールを取り入れていく順番でやってますね。</p>
  </div>

  <p class="codegra" id="feinheadline_html">アコーディオン型の見出しを差し込むhtmlコード</p>
  <div class="code-container">
   <pre><code class="feintyping language-html">
&lt;button id=&quot;generate-headings&quot; data-open-text=&quot;ナビゲーションメニューをCSS・JavaScriptで用意するの目次を開く ▼&quot;
   data-close-text=&quot;ナビゲーションメニューをCSS・JavaScriptで用意するの目次を閉じる ▲&quot;&gt;ナビゲーションメニューをCSS・JavaScriptで用意するの目次を開く
   ▼&lt;/button&gt;
～ ここにコンテンツ内容 ～
 &lt;script src=&quot;/script/feinheadline1.js&quot;&gt;&lt;/script&gt;
    </code></pre>
  </div>

  <p>このコードで <span class="codecolor">&lt;script src=&quot;/script/feinheadline1.js&quot;&gt;&lt;/script&gt;</span>
   をページ末尾に持ってくる理由はいくつかあります。</p>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="/flower2/flower2(7).JPG" alt="フェードアウト効果の草花写真">
   </div>
   <dl>
    <dt>ページ読み込み速度の向上</dt>
    <dd>htmlファイルを上から下へ順に解析・レンダリングしていく際に、スクリプトタグが先に来ると、そのスクリプトの読み込みと実行を待つ必要があります。<br>
     結果的にページ全体の読み込みが遅くなるんだけど、まぁ普通はそんな気にしなくても大丈夫。</dd>

    <dt>DOMの完全な読み込みの確保</dt>
    <dd>スクリプトがDOM（Document Object Model）を操作する場合、スクリプトが実行される時点でDOMが完全に読み込まれている必要があります。<br>
     DOMについての詳しい説明は<a href="contents/css_tidbit.html">CSSの小ネタ、ちょっとしたUI作成 > DOMについて理解する</a>をご覧ください。<br>
     スクリプトタグをページの末尾に置くことで、全てのHTML要素が読み込まれた後にスクリプトが実行されます。<br>
     これでDOMの操作が確実に行えるようになります。</dd>

    <dt>依存関係の管理</dt>
    <dd>スクリプトが依存する他のリソースが完全に読み込まれていることを確実にするため、スクリプトタグを末尾に置いたほうが良いです。<br>
     これでスクリプトの実行時に必要なリソースが揃っていることを保証できます。<br>
     ここで言うリソースというのは、同一Webページ内で使われているCSSや他のスクリプトを指します。</dd>
   </dl>
  </div>

  <p>早い話が、変なバグに悩まされないようセオリー通りにやっているだけです。<br>
   無理に変化球を投げると動作しないときの原因究明に大変な時間がかかってしまうからね。</p>

  <h3>見出しを作るCSS</h3>
  <p>見出しについては初めからフル表示されているものもありますよ。<br>
   どちらでも良いのですが、私の場合はご覧のとおり長いWebページになりがちなので…<br>
   閲覧者の動きがよりスムーズになるよう、工夫する必要があります。</p>
  <p class="codegra" id="feinheadline_css">アコーディオン型の見出しを作るfeinheadline.css</p>
  <div class="code-container">
   <pre><code class="feintyping language-css">
@charset "UTF-8";

/* 目次アイテムの基本スタイル */
.toc-item {
    color: #1A73E8; /* 文字の色 (Google blue) */
    font-family: inherit; /* 親要素のフォントファミリーを継承 */
    font-size: 100%; /* フォントサイズを100%に設定 */
    margin: 0; /* 外側の余白をなしにする */
    padding: 5px 0; /* 上下に5pxのパディング */
    line-height: 2; /* 行間を2に設定 */
    transition: color 0.3s ease-in-out; /* 色変化のアニメーションを追加 */
    border-bottom: 1px solid #ddd; /* 各項目の下に薄いボーダーラインを追加 */
    padding-bottom: 5px; /* ボーダーラインと内容の間に余白を追加 */
}

/* 目次アイテムをホバーしたときのスタイル */
.toc-item:hover {
    color: #0078D4; /* 文字の色を変更 (Microsoft blue) */
}

/* インデントのスタイル */
.indent-1 {
    text-indent: 1em; /* 半角1字分のインデント */
}

.indent-3 {
    text-indent: 3em; /* 半角3字分のインデント */
}

.indent-5 {
    text-indent: 4em; /* 半角4字分のインデント */
}

/* 各見出しタグ用のスタイル */
.toc-item-h1 a,
.toc-item-h2 a,
.toc-item-h3 a,
.toc-item-h4 a,
.feinheadline-h5 a,
.toc-item-h6 a {
    padding: 5px 10px; /* 内側の余白を追加 */
}

/* 目次生成ボタンのスタイル */
#generate-headings {
    background-color: transparent; /* 背景色を透明に設定 */
    color: #1A73E8; /* 文字の色 (Google blue) */
    font-family: inherit; /* 親要素のフォントファミリーを継承 */
    font-size: 120%; /* フォントサイズを120%に設定 */
    border-radius: 5px; /* 四隅を丸める */
    border: none; /* ボーダーをなしにする */
    text-decoration: underline; /* 下線を追加 */
    cursor: pointer; /* カーソルをポインターに変更 */
    text-align: left; /* テキストを左揃えにする */
    background: linear-gradient(to bottom, rgba(173, 216, 230, 0.5), rgba(173, 216, 230, 0)); /* 背景のグラデーションを追加 */
    font-weight: bold; /* 文字を太字にする */
    transition: background 0.3s ease-in-out, color 0.3s ease-in-out; /* 背景色と文字色の変化にアニメーションを追加 */
}

/* 目次生成ボタンをホバーしたときのスタイル */
#generate-headings:hover {
    color: #0078D4; /* 文字の色を変更 (Microsoft blue) */
    background: linear-gradient(to bottom, rgba(173, 216, 230, 0.2), rgba(173, 216, 230, 0)); /* 背景のグラデーションを変更 */
}

/* 目次コンテナのスタイル */
#toc-container {
    margin-top: 1.5em; /* 上に余白を追加 */
    height: 0; /* 初期状態の高さを0に設定 */
    overflow: hidden; /* はみ出たコンテンツを隠す */
    transition: height 0.5s ease-out; /* 高さの変化にアニメーションを追加 */
}

/* 目次コンテナが表示されたときのスタイル */
#toc-container.show {
    height: auto; /* 高さを自動に設定 */
}
    </code></pre>
  </div>

  <p>こういうページをご覧になるからはご存じと思いますが、「コンテナ」というのは、ある種の箱やエリアといったものを想像して頂けると分かりやすいかと。<br>
   ここではCSSによるアニメーション設定について見ていきます。</p>

  <h4>CSSのトランジションプロパティでアニメーションを追加</h4>

  <p><span class="codecolor">transition: height 0.5s ease-out;</span> は、CSSのトランジションプロパティを用いて高さの変化にアニメーションを追加するものです。<br>
   要素の高さが変更される際にスムーズなアニメーション効果が適用されます。<br>
   このプロパティを詳しく見てみましょう。</p>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="/flower2/flower2(8).JPG" alt="フェードアウト効果の草花写真">
   </div>
   <dl>
    <dt>transition</dt>
    <dd>トランジションプロパティ。<br>
     どのプロパティの変化にアニメーションを適用するかを指定します。<br>
     ここでは高さ（<span class="codecolor">height</span>）に対してアニメーションを適用しています。</dd>

    <dt>height</dt>
    <dd>トランジションを適用するプロパティ。<br>
     要素の高さが変更される時にアニメーションが適用されます。<br>
     上記通り、高さに対して設定しているわけです。</dd>

    <dt>0.5s</dt>
    <dd>トランジションの持続時間。<br>
     ここでは0.5秒（500ミリ秒）で高さの変化が完了するように設定していますが…<br>
     ちょっと悩んでいます。<br>
     あるいは1秒とか、もっと遅いほうが良いのかもしれない。<br>
     まぁそういう悩みから来るコード変更を徹底管理するために<a href="/another-eden/atelier_studio.html">ファンサイト制作のためのアトリエ</a>というページを作ったんだけどね。</dd>

    <dt>ease-out</dt>
    <dd>トランジションのイージング関数。<br>
     アニメーションの速度変化を制御します。<br>
     <span class="codecolor">ease-out</span>
     はアニメーションの終わりをゆっくりとする効果があります。<br>
     高さの変更が自然に見えるようになります。
    </dd>
   </dl>
  </div>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="/flower2/flower2(9).JPG" alt="フェードアウト効果の草花写真">
   </div>
   <p>このプロパティの効果をまとめると、要素の高さが変更される際に、0.5秒間でスムーズなアニメーションを適用し、アニメーションの終わりをゆっくりとすることで、視覚的に自然な効果を実現します。<br>
    細かいようですが、こういうことをやらないとカクカクしたページになっちゃいます。<br>
    よく言われるところの「あぁ…個人サイトだね…」と感じにくくできるでしょう。</p>
  </div>

  <p>次はJavaScriptへ移ります。<br>
   このCSSと密接に関連しているので、注意して頂ければと思います。</p>

  <h3>見出しを作るJavaScript</h3>
  <p>このコードは、ページが読み込まれた後に目次を自動生成し、ボタンをクリックすると目次の表示を切り替える仕組みを作っています。<br>
   ここで作られたものが上述のCSSと絡んで、滑らかな見出しが自動的に生成されるようになります。</p>

  <p class="codegra" id="feinheadline1_js">アコーディオン型の見出しを作るfeinheadline1.js</p>
  <div class="code-container">
   <pre><code class="feintyping language-javascript">
document.addEventListener("DOMContentLoaded", function () {
 let headingsGenerated = false;
 document.getElementById("generate-headings").addEventListener("click", function () {
  let tocContainer = document.getElementById("toc-container");
  let button = document.getElementById("generate-headings");
  if (!headingsGenerated) {
   if (!tocContainer) {
    tocContainer = document.createElement("div");
    tocContainer.id = "toc-container";
   }
   let headings = document.querySelectorAll("h1, h2, h3, h4, h5, h6");
   headings.forEach((heading, index) => {
    let id = `heading-${index + 1}`;
    heading.id = id;
    let tocItem = document.createElement("p");
    tocItem.classList.add("toc-item");
    switch (heading.tagName.toLowerCase()) {
     case "h1":
      tocItem.classList.add("toc-item-h1");
      break;
     case "h2":
      tocItem.classList.add("toc-item-h2");
      break;
     case "h3":
      tocItem.classList.add("indent-1");
      break;
     case "h4":
      tocItem.classList.add("indent-3");
      break;
     case "h5":
      tocItem.classList.add("indent-5", "feinheadline-h5");
      heading.classList.add("feinheadline-h5");
      break;
     case "h6":
      tocItem.classList.add("indent-5");
      break;
    }
    let link = document.createElement("a");
    link.href = `#${id}`;
    link.textContent = heading.textContent;
    tocItem.appendChild(link);
    tocContainer.appendChild(tocItem);
   });
   document.getElementById("generate-headings").insertAdjacentElement('afterend', tocContainer);
   headingsGenerated = true;
  }
  if (tocContainer.classList.contains("show")) {
   tocContainer.style.height = "0";
   button.textContent = button.getAttribute("data-open-text");
  } else {
   tocContainer.style.height = tocContainer.scrollHeight + "px";
   button.textContent = button.getAttribute("data-close-text");
  }
  setTimeout(() => {
   tocContainer.classList.toggle("show");
  }, 10);
 });
});
    </code></pre>
  </div>

  <h4>見出し作りを手作業でやるの？！</h4>
  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="/flower2/flower2(10).JPG" alt="フェードアウト効果の草花写真">
   </div>
   <p>いやいや…厳しいと思います。<br>
    1ページ作るたびに新しい見出しが生まれるのですから、それらを全て挿入する作業を人力でなんて、現実味がないでしょう。<br>
    ミスの原因にもなりますし、何かしらの形で自動生成されるようにした方が良いかと思います。<br>
    ここで紹介しているのは、その一例です。<br>
    段階的に説明していきますよ？<br>
    まずは日本語で書いてから、各コードを具体的に説明してみます。</p>
  </div>

  <h4>見出し生成コードの動き</h4>
  <p>Webページが読み込まれます。<br>
   このページにあるスクリプトは、ページが完全に読み込まれると動き始めます。</p>

  <p>まず、ページが全部読み込まれると、そのスクリプトが動き始めます。<br>
   そして、「目次ボタン」がクリックされるのを待っています。<br>
   ページの中にはたくさんの見出し（タイトル）があるのですが、これを一つ一つ拾って目次を作っていきます。</p>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="/flower2/flower2(12).JPG" alt="フェードアウト効果の草花写真">
   </div>
   <p>ここが大変重要です。</p>
   <p>見出しを一つ一つ拾って目次を作る部分がループ処理になっています。<br>
    具体的には、<span class="codecolor">forEach</span> というループを使って、ページ内のすべての見出し要素（<span class="codecolor">h1</span> から <span
     class="codecolor">h6</span>）を順番に処理しています。<br>
    ループ処理を使うことで、ページ内のすべての見出しに対して同じ処理を繰り返し行い、それぞれの見出しに対応する目次の項目を作成しているのです。<br>
    こうすることで、手作業ではなく自動的に目次を生成することができ、たとえページ内にたくさんの見出しがあっても正確に目次を作成することができます。<br>
    このループ処理のおかげで、目次の生成が効率的かつ正確に行えるわけ。</p>
  </div>

  <p>さて、「目次ボタン」をクリックすると、スクリプトはまず目次を入れる箱を探します。<br>
   その箱が見つからなかった場合は、新しく箱を作り出します。<br>
   そして、見出しがまだ目次に追加されていないかを確認します。</p>

  <p>次に、ページの中にある全ての見出しを探します。<br>
   それぞれの見出しには特別なIDを付けて、目次の項目に追加します。<br>
   この目次の項目はリンクになっていて、クリックするとその見出しにジャンプできます。</p>

  <p>目次が完成したら、目次の箱を「目次ボタン」の後ろに置きます。<br>
   これで、目次が再度作られることはありません。</p>

  <div class="flowerclearfix">
   <div class="flowerfade-out">
    <img src="/flower2/flower2(24).JPG" alt="フェードアウト効果の草花写真">
   </div>
   <p>最後に、目次が表示されているかどうかを確認します。<br>
    もし表示されていたら、目次を隠してボタンのテキストを「目次を開く」に変更します。<br>
    逆に表示されていなかったら、目次を表示してボタンのテキストを「目次を閉じる」に変更します。</p>

   <p>これがスクリプトの流れです。<br>
    目次を自動的に生成し、クリックで表示・非表示を切り替える動きをしているってことですね！<br>
    では、具体的にコードを見てみましょう。</p>
  </div>

  <h5>1. DOMの読み込み完了を待つ</h5>
  <div class="code-container">
   <pre><code class="feintyping language-javascript">
document.addEventListener("DOMContentLoaded", function () {
    </code></pre>
  </div>
  <p><span class="codecolor">DOMContentLoaded</span> イベントは、HTMLが完全に読み込まれた後に実行されます。<br>
   このイベントリスナー内にすべてのスクリプトが含まれています。<br>
   ページが読み込まれると動き始めるということです。</p>

  <h5>2. 状態の初期化</h5>
  <div class="code-container">
   <pre><code class="feintyping language-javascript">
let headingsGenerated = false;
    </code></pre>
  </div>
  <p>目次が既に生成されたかどうかを追跡するためのフラグ変数です。<br>
   目次がまだ作られていないか確認しないといけません。<br>
   最初は <span class="codecolor">false</span> になっています。</p>

  <h5>3. ボタンのクリックイベントを追加</h5>
  <div class="code-container">
   <pre><code class="feintyping language-javascript">
document.getElementById("generate-headings").addEventListener("click", function () {
    </code></pre>
  </div>
  <p>ボタンがクリックされたときに実行される関数を定義しています。<br>
   こちらはボタンクリックで動き始めるということです。</p>

  <h4>目次コンテナの取得または作成</h4>
  <p>次の4と5で、既に目次の箱（コンテナ）があるか確認し、無ければ新しい箱を作ります。</p>

  <h5>4. 目次コンテナの取得</h5>
  <div class="code-container">
   <pre><code class="feintyping language-javascript">
let tocContainer = document.getElementById("toc-container");
let button = document.getElementById("generate-headings");
    </code></pre>
  </div>
  <p>まず、<span class="codecolor">getElementById</span> メソッドを使用して、<span class="codecolor">id</span> 属性が <span
    class="codecolor">toc-container</span> の要素を取得します。<br>
   この要素が目次コンテナです。<br>
   また、<span class="codecolor">generate-headings</span> ボタンも同じ方法で取得します。</p>

  <h5>5. 目次コンテナが既に存在するか確認</h5>
  <div class="code-container">
   <pre><code class="feintyping language-javascript">
if (!headingsGenerated) {
    if (!tocContainer) {
        tocContainer = document.createElement("div");
        tocContainer.id = "toc-container";
    }
    </code></pre>
  </div>
  <p>目次コンテナが既に存在するか確認します。<br>
   存在しない場合（<span class="codecolor">tocContainer</span> が <span class="codecolor">null</span>
   の場合）には、新しい <span class="codecolor">div</span> 要素を作成し、その <span class="codecolor">id</span> を <span
    class="codecolor">toc-container</span> に設定します。<br>
   <span class="codecolor">headingsGenerated</span> フラグが <span class="codecolor">false</span>
   の場合にのみ、新しい目次コンテナが作成されるようにしています。
  </p>

  <h5>6. 全ての見出し要素（h1〜h6）を取得</h5>
  <div class="code-container">
   <pre><code class="feintyping language-javascript">
let headings = document.querySelectorAll("h1, h2, h3, h4, h5, h6");
    </code></pre>
  </div>
  <p><span class="codecolor">querySelectorAll</span> メソッドを使用して、ページ内の全ての見出し要素（<span class="codecolor">h1</span> から <span
    class="codecolor">h6</span> まで）を取得します。<br>
   ページ内の見出し（タイトル）を全部見つける部分ですね。</p>

  <p>次の7～9で、各見出しごとに目次の項目を作ります。<br>
   その項目にリンクを付けて、クリックするとその見出しに飛べるようにします。</p>

  <h5>7. 各見出し要素に対して目次アイテムを作成</h5>
  <div class="code-container">
   <pre><code class="feintyping language-javascript">
headings.forEach((heading, index) => {
    let id = `heading-${index + 1}`;
    heading.id = id;
    let tocItem = document.createElement("p");
    tocItem.classList.add("toc-item");
    </code></pre>
  </div>
  <p>各見出し要素をループして処理します。<br>
   各見出し要素に一意のID（<span class="codecolor">heading-1</span>、<span class="codecolor">heading-2</span> など）を付与します。<br>
   新しい <span class="codecolor">p</span> 要素を作成し、クラス <span class="codecolor">toc-item</span> を追加します。</p>

  <h5>8. 見出しのタグに応じて目次アイテムにクラスを追加</h5>
  <div class="code-container">
   <pre><code class="feintyping language-javascript">
switch (heading.tagName.toLowerCase()) {
    case "h1":
        tocItem.classList.add("toc-item-h1");
        break;
    case "h2":
        tocItem.classList.add("toc-item-h2");
        break;
    case "h3":
        tocItem.classList.add("indent-1");
        break;
    case "h4":
        tocItem.classList.add("indent-3");
        break;
    case "h5":
        tocItem.classList.add("indent-5", "feinheadline-h5");
        heading.classList.add("feinheadline-h5");
        break;
    case "h6":
        tocItem.classList.add("indent-5");
        break;
}
    </code></pre>
  </div>
  <p>見出しのタグ名に応じて、対応するクラスを目次アイテムに追加します。</p>

  <h5>9. リンクを作成して目次アイテムに追加</h5>
  <div class="code-container">
   <pre><code class="feintyping language-javascript">
let link = document.createElement("a");
link.href = `#${id}`;
link.textContent = heading.textContent;
tocItem.appendChild(link);
tocContainer.appendChild(tocItem);
    </code></pre>
  </div>
  <p>各見出しへのリンクを作成し、目次アイテム（<span class="codecolor">p</span> 要素）に追加します。<br>
   目次アイテムを目次コンテナに追加します。</p>

  <h5>10. 目次コンテナをボタンの後に挿入</h5>
  <div class="code-container">
   <pre><code class="feintyping language-javascript">
document.getElementById("generate-headings").insertAdjacentElement('afterend', tocContainer);
headingsGenerated = true;
    </code></pre>
  </div>

  <p>目次コンテナを生成ボタンの後に挿入し、<span class="codecolor">headingsGenerated</span> フラグを <span
    class="codecolor">true</span>に更新します。<br>
   これにより、目次が再生成されないようになります。<br>
   目次の箱をボタンの後ろに配置し、目次が生成されたことを記録するといったイメージでしょうか。</p>

  <h4>目次コンテナの表示/非表示の切り替え</h4>
  <p>目次が表示されているかどうかを確認し、表示/非表示を切り替えます。<br>
   ボタンのテキストも変更します。</p>

  <h5>11. 目次コンテナの表示状態をチェック</h5>
  <div class="code-container">
   <pre><code class="feintyping language-javascript">
if (tocContainer.classList.contains("show")) {
    tocContainer.style.height = "0";
    button.textContent = button.getAttribute("data-open-text");
} else {
    tocContainer.style.height = tocContainer.scrollHeight + "px";
    button.textContent = button.getAttribute("data-close-text");
}
    </code></pre>
  </div>
  <p><span class="codecolor">show</span> クラスが目次コンテナに含まれているかを確認します。<br>
   含まれている場合は、目次コンテナの高さを <span class="codecolor">0</span> に設定し、ボタンのテキストを「目次を開く」に変更します。<br>
   含まれていない場合は、目次コンテナの高さを内容に合わせて自動調整し、ボタンのテキストを「目次を閉じる」に変更します。</p>

  <h5>12. トグルで目次コンテナの表示/非表示を切り替え</h5>
  <div class="code-container">
   <pre><code class="feintyping language-javascript">
setTimeout(() => {
    tocContainer.classList.toggle("show");
}, 10);
    </code></pre>
  </div>
  <p>少し遅延させて、目次コンテナに <span class="codecolor">show</span> クラスをトグルで追加または削除します。<br>
   この遅延により、アニメーションがスムーズに実行されます。</p>

  <p>以上を持ちまして、ページの見出しを収集し、クリックで表示/非表示を切り替えられる目次を生成するスクリプトの説明となります。</p>

  <!-- ●ここから人間用のフッター● -->
  <hr id="feinhr">
  <div class="spacer"></div>

  <section class="sitemap">
   <h2 class="sitemap_heading">サイトマップ</h2>
   <p><a href="/pages/pagelist">全ページをリスト化したサイトマップ</a>も用意していますが、けっこうなページ数があります。<br>
    下記の「カテゴリー分けサイトマップ」のほうが使いやすいでしょう。</p>
   <p><a href="/another-eden/anaden_sitemap.html">
     アナザーエデン関連ページ・サイトマップ</a><br>
    アナザーエデンの強敵戦やストーリーコンテンツのリスト、お勧めバッジなどを掲載したコーナーです。<br>
    期間限定のない普通のRPGですので、初心者でも安心して続けていけるゲームとなっています。<br>
    もっとも重要なグラスタについては、場所別に網羅した表があります。</p>


   <p><a href="/contents/site_create.html">
     個人サイトのホスティングとコンテンツ作成</a><br>
    個人でウェブサイトを作るなら時間をかけて。<br>
    HTML・CSS・JavaScriptの書き方はもちろん、無料かつ広告なしでホームページを作る方法を掲載したコーナーです。<br>
    Webデザインやレイアウトについても書いてあります。</p>
   <p><a href="/fish/fish_sitemap.html">魚釣りなどアウトドアのエリア</a><br>
    ゲームとパソコンだけじゃなく、アウトドアも趣味なんです。<br>
    このコーナーでは魚釣りの記録とか、魚料理のレシピ、はたまたサイクリングなどなど。<br>
    アウトドアに関連するコンテンツが詰め込まれています。</p>

  </section>

  <!-- ページ上部へ戻るボタン -->
  <button id="scrollToTopBtn" onclick="scrollToTop()">ページ上部へ戻る</button>
  <script src="/script/feinScroll.js"></script>

  <div class="spacer"></div>

  <footer>
   <!--common google digital leader-->

   <div id="commongdl"></div>
   <script src="/externalization/common.js"></script>

   <div class="spacer"></div>


   <div class="spacer"></div>
   <p class="portal" id="updated-date">この <a href="https://feinatelier.org/">fein's personal
     site</a> は、2023/7/4に開設された <a href="https://portal.feinatelier.org/">fein's portal</a>
    を母体として、yyyy/mm/ddに至るまで更新し続けられています。</p>
   <script>
    document.addEventListener('DOMContentLoaded', function () {
     const today = new Date();
     const year = today.getFullYear();
     const month = String(today.getMonth() + 1).padStart(2, '0');
     const day = String(today.getDate()).padStart(2, '0');
     const dateElement = document.getElementById('updated-date');
     dateElement.innerHTML = `この <a href="https://feinatelier.org/">Fein Atelier - org</a> は、2023/7/4に開設された <a href="https://portal.feinatelier.org/">fein's portal</a> を母体として、${year}/${month}/${day}に至るまで更新し続けられています。`;
    });
   </script>

  </footer>

 </div><!--レスポンシブデザイン-->

 <script src="/script/feinheadline1.js"></script><!--見出しの自動生成-->

 <!-- ●ここまで人間用のフッター。直下でbodyを閉める● -->
</body>

</html>
